<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NODINOPRO - South African Road Signs Platform</title>
    <style>
        /* ==================== RESET & BASE STYLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: auto !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .hidden {
            display: none !important;
        }

        /* ==================== SECURITY LAYER STYLES ==================== */
        #securityLayer {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .security-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
        }

        .security-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .security-header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .security-header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-block;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(86, 171, 47, 0.3);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* ==================== BANK DETAILS STYLES ==================== */
        .bank-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            margin: 20px 0;
        }

        .bank-info h4 {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }

        .bank-info p {
            margin: 8px 0;
            font-size: 14px;
        }

        .bank-info strong {
            color: #333;
            min-width: 120px;
            display: inline-block;
        }

        /* ==================== MAIN PLATFORM LAYOUT ==================== */
        #mainPlatform {
            display: none;
            min-height: 100vh;
            background: #f5f7fa;
        }

        .platform-header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h1 {
            color: #333;
            font-size: 1.8em;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .platform-layout {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* ==================== SIDE NAVIGATION ==================== */
        #sideNav {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            max-height: calc(100vh - 70px);
            position: sticky;
            top: 70px;
        }

        .side-nav-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .side-nav-links {
            padding: 20px 0;
        }

        .side-nav-link {
            display: block;
            padding: 12px 25px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .side-nav-link:hover {
            background: #f8f9fa;
            border-left-color: #667eea;
        }

        .side-nav-link.active {
            background: #667eea;
            color: white;
            border-left-color: #764ba2;
        }

        /* ==================== MAIN CONTENT AREA ==================== */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 70px);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==================== ROAD SIGNS STYLES ==================== */
        .signs-filter {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active, .filter-btn:hover {
            background: #667eea;
            color: white;
        }

        #signsContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .road-sign {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #333;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-weight: bold;
            color: #333;
        }

        .road-sign:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .road-sign.octagon {
            background: #dc3545;
            color: white;
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
        }

        .road-sign.triangle {
            background: #ffc107;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        .road-sign.circle {
            background: #007bff;
            color: white;
            border-radius: 50%;
        }

        .road-sign.rectangle {
            background: #28a745;
            color: white;
        }

        .sign-tooltip {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .road-sign:hover .sign-tooltip {
            opacity: 1;
        }

        /* ==================== MODAL STYLES ==================== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        /* ==================== ASSESSMENT STYLES ==================== */
        .assessment-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .assessment-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .assessment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .quiz-options {
            margin: 20px 0;
        }

        .quiz-option {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .quiz-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        /* ==================== AFFILIATE DASHBOARD STYLES ==================== */
        .affiliate-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .affiliate-code-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 20px 0;
            text-align: center;
        }

        .affiliate-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #667eea;
        }

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 768px) {
            .platform-layout {
                flex-direction: column;
            }

            #sideNav {
                width: 100%;
                position: static;
                max-height: none;
            }

            .main-content {
                padding: 20px;
            }

            .security-container {
                padding: 20px;
            }

            .platform-header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }

            .header-left h1 {
                font-size: 1.5em;
            }

            .assessment-types {
                grid-template-columns: 1fr;
            }

            .affiliate-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            #signsContainer {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 15px;
            }

            .road-sign {
                width: 80px;
                height: 80px;
                font-size: 0.8em;
            }
        }

        @media (max-width: 480px) {
            .affiliate-stats {
                grid-template-columns: 1fr;
            }

            .security-header h1 {
                font-size: 2em;
            }

            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }

        /* ==================== UTILITY CLASSES ==================== */
        .text-center { text-align: center; }
        .text-success { color: #28a745; }
        .text-warning { color: #ffc107; }
        .text-danger { color: #dc3545; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .p-20 { padding: 20px; }

        /* ==================== SCROLLBAR STYLING ==================== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <!-- ==================== SECURITY LAYER ==================== -->
    <div id="securityLayer">
        <div class="security-container">
            <div class="security-header">
                <h1>üö¶ NODINOPRO</h1>
                <p class="subtitle">South African Road Signs & K53 Mastery Platform</p>
            </div>

            <form onsubmit="event.preventDefault(); submitPaymentRequest(); return false;">
                <div class="form-group">
                    <label for="userName">Full Name *</label>
                    <input type="text" id="userName" placeholder="Enter your full name" required 
                           oninput="updatePaymentReference()" minlength="2">
                </div>

                <div class="form-group">
                    <label for="userPhone">Phone Number *</label>
                    <input type="tel" id="userPhone" placeholder="e.g., 0821234567" required 
                           oninput="updatePaymentReference()" pattern="[0-9]{10}">
                </div>

                <div class="form-group">
                    <label for="referralCode">Affiliate Code (Optional)</label>
                    <input type="text" id="referralCode" placeholder="Enter affiliate code if referred">
                </div>

                <div class="form-group">
                    <label>Payment Reference</label>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; font-weight: bold; text-align: center;">
                        <span id="dynamicReference">ENTER_NAME_AND_PHONE</span>
                    </div>
                    <input type="hidden" id="paymentReference" value="">
                </div>

                <!-- Bank Details Section -->
                <div id="bankDetails" class="hidden">
                    <!-- Dynamically filled by JavaScript -->
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    üìß GET ACCESS - R50
                </button>
            </form>

            <!-- OTP Verification Section -->
            <div id="otpSection" class="hidden" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e9ecef;">
                <h3 style="text-align: center; margin-bottom: 20px;">üîê Verify OTP</h3>
                
                <div class="form-group">
                    <label for="otpCode">6-Digit OTP *</label>
                    <input type="text" id="otpCode" placeholder="Enter OTP sent to you" maxlength="6" pattern="[0-9]{6}">
                </div>

                <div style="text-align: center; margin: 15px 0;">
                    <strong>Time Remaining: <span id="otpTime" style="color: #dc3545;">15:00</span></strong>
                </div>

                <button type="button" onclick="verifyOTP()" class="btn btn-success btn-block">
                    ‚úÖ VERIFY & ACCESS PLATFORM
                </button>

                <div id="referralInfo" class="hidden" style="margin-top: 15px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                    <p style="margin: 0; font-size: 14px;">
                        üë• Referred by: <strong id="referrerName"></strong><br>
                        üí∞ You'll earn R50 when they join!
                    </p>
                </div>
            </div>

            <div style="margin-top: 25px; text-align: center; font-size: 14px; color: #666;">
                <p>üí∞ R50 one-time payment ‚Ä¢ üì± WhatsApp OTP verification ‚Ä¢ üöÄ Instant access</p>
            </div>
        </div>
    </div>

    <!-- ==================== MAIN PLATFORM ==================== -->
    <div id="mainPlatform" class="hidden">
        <!-- Header -->
        <div class="platform-header">
            <div class="header-left">
                <h1>üö¶ NODINOPRO PLATFORM</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    üë§ <span id="currentUser">User</span> | 
                    üí∞ <span id="earningsDisplay">Earnings: R0</span>
                </div>
                <button onclick="logout()" class="btn" style="background: #dc3545; color: white; padding: 8px 15px;">
                    üö™ Logout
                </button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="platform-layout">
            <!-- Side Navigation -->
            <div id="sideNav">
                <div class="side-nav-header">
                    <h3>Navigation</h3>
                </div>
                <div class="side-nav-links">
                    <a href="#" class="side-nav-link active" data-page="home" onclick="navigateToPage('home')">
                        üè† Dashboard
                    </a>
                    <a href="#" class="side-nav-link" data-page="road-signs" onclick="navigateToPage('road-signs')">
                        üö¶ Road Signs
                    </a>
                    <a href="#" class="side-nav-link" data-page="assessments" onclick="navigateToPage('assessments')">
                        üìù K53 Tests
                    </a>
                    <a href="#" class="side-nav-link" data-page="affiliate-dashboard" onclick="navigateToPage('affiliate-dashboard')">
                        üí∞ Affiliate Earnings
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Home Page -->
                <div id="home" class="page active">
                    <h2>Welcome to NODINOPRO! üéâ</h2>
                    <p style="margin: 15px 0 30px; color: #666;">
                        Your complete South African road signs and K53 learning platform.
                    </p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                        <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                            <div style="font-size: 3em; margin-bottom: 15px;">üö¶</div>
                            <h3>Road Signs</h3>
                            <p>Complete database of all South African road signs with detailed explanations.</p>
                            <button onclick="navigateToPage('road-signs')" class="btn btn-primary" style="margin-top: 15px;">
                                Explore Signs
                            </button>
                        </div>

                        <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                            <div style="font-size: 3em; margin-bottom: 15px;">üìù</div>
                            <h3>K53 Tests</h3>
                            <p>Practice tests and assessments to prepare for your driver's license exam.</p>
                            <button onclick="navigateToPage('assessments')" class="btn btn-primary" style="margin-top: 15px;">
                                Start Tests
                            </button>
                        </div>

                        <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                            <div style="font-size: 3em; margin-bottom: 15px;">üí∞</div>
                            <h3>Earn Money</h3>
                            <p>Refer friends and earn R50 for each person who joins through your code.</p>
                            <button onclick="navigateToPage('affiliate-dashboard')" class="btn btn-primary" style="margin-top: 15px;">
                                View Earnings
                            </button>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-top: 30px;">
                        <h3 style="margin-bottom: 15px;">üöÄ Quick Start Guide</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div>
                                <strong>1. Study Road Signs</strong>
                                <p style="font-size: 14px; margin-top: 5px;">Learn all official road signs in the database.</p>
                            </div>
                            <div>
                                <strong>2. Take Practice Tests</strong>
                                <p style="font-size: 14px; margin-top: 5px;">Test your knowledge with K53-style questions.</p>
                            </div>
                            <div>
                                <strong>3. Share & Earn</strong>
                                <p style="font-size: 14px; margin-top: 5px;">Use your affiliate code to earn money.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Road Signs Page -->
                <div id="road-signs" class="page">
                    <h2>üö¶ South African Road Signs</h2>
                    <p style="margin: 10px 0 20px; color: #666;">
                        Click on any sign to learn more about its meaning and usage.
                    </p>

                    <div class="signs-filter">
                        <button class="filter-btn active" onclick="filterSigns('all')">All Signs</button>
                        <button class="filter-btn" onclick="filterSigns('Control')">Control</button>
                        <button class="filter-btn" onclick="filterSigns('Warning')">Warning</button>
                        <button class="filter-btn" onclick="filterSigns('Information')">Information</button>
                    </div>

                    <div id="signsContainer">
                        <!-- Road signs will be loaded here by JavaScript -->
                    </div>
                </div>

                <!-- Assessments Page -->
                <div id="assessments" class="page">
                    <h2>üìù K53 Practice Tests</h2>
                    <p style="margin: 10px 0 30px; color: #666;">
                        Test your knowledge with these practice assessments.
                    </p>

                    <div class="assessment-types">
                        <div class="assessment-card" onclick="startTest('roadSigns')">
                            <div style="font-size: 3em; margin-bottom: 15px;">üö¶</div>
                            <h3>Road Signs Test</h3>
                            <p>Test your knowledge of South African road signs and their meanings.</p>
                            <div style="margin-top: 15px; color: #667eea; font-weight: bold;">
                                25 Questions ‚Ä¢ 30 Minutes
                            </div>
                        </div>

                        <div class="assessment-card" onclick="startTest('rules')">
                            <div style="font-size: 3em; margin-bottom: 15px;">üìö</div>
                            <h3>Road Rules Test</h3>
                            <p>Test your knowledge of K53 road rules and regulations.</p>
                            <div style="margin-top: 15px; color: #667eea; font-weight: bold;">
                                20 Questions ‚Ä¢ 25 Minutes
                            </div>
                        </div>
                    </div>

                    <!-- Test Container -->
                    <div id="testContainer" class="hidden">
                        <div class="progress-bar">
                            <div id="testProgress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        
                        <div id="questionArea">
                            <!-- Questions will be loaded here -->
                        </div>

                        <div class="quiz-navigation">
                            <button id="prevQuestion" class="btn" onclick="ASSESSMENT_SYSTEM.previousQuestion()">
                                ‚óÄ Previous
                            </button>
                            <button id="submitTest" class="btn btn-primary" onclick="ASSESSMENT_SYSTEM.submitTest()">
                                Submit Test
                            </button>
                            <button id="nextQuestion" class="btn btn-primary" onclick="ASSESSMENT_SYSTEM.nextQuestion()">
                                Next ‚ñ∂
                            </button>
                        </div>
                    </div>

                    <!-- Results Area -->
                    <div id="resultsArea" class="hidden">
                        <!-- Results will be displayed here -->
                    </div>
                </div>

                <!-- Affiliate Dashboard -->
                <div id="affiliate-dashboard" class="page">
                    <h2>üí∞ Affiliate Earnings</h2>
                    <p style="margin: 10px 0 30px; color: #666;">
                        Track your referrals and earnings from the NODINOPRO platform.
                    </p>

                    <div class="affiliate-code-container">
                        <h3>Your Affiliate Code</h3>
                        <div class="affiliate-code" id="userAffiliateCode">LOADING...</div>
                        <button onclick="copyAffiliateCode()" class="btn btn-primary">
                            üìã Copy Affiliate Code
                        </button>
                        <p style="margin-top: 15px; font-size: 14px; color: #666;">
                            Share this code with friends. You earn <strong>R50</strong> for each person who joins!
                        </p>
                    </div>

                    <div class="affiliate-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalReferrals">0</div>
                            <div>Total Referrals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="approvedReferrals">0</div>
                            <div>Approved Referrals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pendingReferrals">0</div>
                            <div>Pending Referrals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalEarnings">R0</div>
                            <div>Total Earnings</div>
                        </div>
                    </div>

                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-top: 30px;">
                        <h3 style="margin-bottom: 20px;">üìã Referral History</h3>
                        <div id="referralList">
                            <!-- Referrals will be listed here -->
                        </div>
                    </div>

                    <div style="background: #e7f3ff; padding: 20px; border-radius: 10px; margin-top: 30px;">
                        <h4 style="color: #007bff; margin-bottom: 15px;">üí° How It Works</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div>
                                <strong>1. Share Your Code</strong>
                                <p style="font-size: 14px; margin-top: 5px;">Give your affiliate code to friends and family.</p>
                            </div>
                            <div>
                                <strong>2. They Join</strong>
                                <p style="font-size: 14px; margin-top: 5px;">They use your code when signing up for R50 access.</p>
                            </div>
                            <div>
                                <strong>3. You Earn</strong>
                                <p style="font-size: 14px; margin-top: 5px;">Once their payment is verified, you get R50!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Road Sign Modal -->
    <div id="signModal" class="modal hidden">
        <div class="modal-content">
            <button id="closeModal" class="modal-close" onclick="PLATFORM_INIT.closeSignModal()">√ó</button>
            <div id="modalContent">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        // NODINOPRO PLATFORM CORE - COMPLETE FUNCTIONALITY
        console.log('üöÄ NODINOPRO Platform Core Loading...');

        // ==================== ROAD SIGNS DATABASE ====================
        const ROAD_SIGNS_DATABASE = [
            // CONTROL SIGNS
            { id: 1, sign_code: "R1", description: "Stop Sign", category: "Control" },
            { id: 2, sign_code: "R1.1", description: "Stop Sign", category: "Control" },
            { id: 3, sign_code: "R1.2", description: "Stop/Yield", category: "Control" },
            { id: 4, sign_code: "R1.3", description: "3-Way Stop", category: "Control" },
            { id: 5, sign_code: "R1.4", description: "4-Way Stop", category: "Control" },
            { id: 6, sign_code: "R1.5", description: "Stop/Go Sign", category: "Control" },
            { id: 7, sign_code: "R2", description: "Yield Sign", category: "Control" },
            { id: 8, sign_code: "R2.1", description: "Yield to Pedestrians", category: "Control" },
            { id: 9, sign_code: "R2.2", description: "Yield at Mini-circle", category: "Control" },
            { id: 10, sign_code: "R3", description: "No Entry Sign", category: "Control" },
            { id: 11, sign_code: "R4.1", description: "One-way Roadway", category: "Control" },
            { id: 12, sign_code: "R4.2", description: "One-way Roadway", category: "Control" },
            { id: 13, sign_code: "R4.3", description: "One-way Roadway", category: "Control" },
            { id: 14, sign_code: "R5", description: "Pedestrian Priority", category: "Control" },
            { id: 15, sign_code: "R6", description: "Yield to Oncoming Traffic", category: "Control" },
            // COMMAND SIGNS
            { id: 16, sign_code: "R101", description: "Minimum Speed", category: "Command" },
            { id: 17, sign_code: "R102", description: "Vehicles Exceeding Mass", category: "Command" },
            { id: 18, sign_code: "R103", description: "Keep Left", category: "Command" },
            { id: 19, sign_code: "R104", description: "Keep Right", category: "Command" },
            { id: 20, sign_code: "R105", description: "Proceed Left Only", category: "Command" },
            // Add more signs as needed...
            { id: 42, sign_code: "IN11.1", description: "Supplementary Plate", category: "Information" }
        ];

        // ==================== FORM VALIDATION ====================
        const FORM_VALIDATION = {
            validateForm: function() {
                const userName = document.getElementById('userName')?.value.trim();
                const userPhone = document.getElementById('userPhone')?.value.trim();
                
                if (!userName || userName.length < 2) {
                    alert('‚ùå Please enter a valid name (minimum 2 characters)');
                    return false;
                }
                
                const cleanPhone = userPhone?.replace(/\D/g, '');
                if (!cleanPhone || cleanPhone.length < 10) {
                    alert('‚ùå Please enter a valid South African phone number (10 digits)');
                    return false;
                }
                
                const nameRegex = /^[A-Za-z\s]+$/;
                if (!nameRegex.test(userName)) {
                    alert('‚ùå Name can only contain letters and spaces');
                    return false;
                }
                
                console.log('‚úÖ Form validation passed');
                return true;
            },
            
            validateOTP: function(otp) {
                if (!otp || otp.length !== 6 || !/^\d+$/.test(otp)) {
                    alert('‚ùå Please enter a valid 6-digit OTP');
                    return false;
                }
                return true;
            }
        };

        // ==================== AFFILIATE SYSTEM ====================
        const AFFILIATE_SYSTEM = {
            commissionRate: 50,
            
            generateAffiliateCode: function(userPhone) {
                const cleanPhone = userPhone.replace(/\D/g, '').slice(-4);
                const code = 'NODI' + cleanPhone + Math.floor(100 + Math.random() * 900);
                console.log('üîë Generated affiliate code:', code);
                return code;
            },
            
            trackReferral: function(referralCode, newUser) {
                if (!referralCode) {
                    console.log('‚ö†Ô∏è No referral code provided');
                    return null;
                }
                
                const referralData = {
                    referrerCode: referralCode,
                    newUser: newUser,
                    timestamp: Date.now(),
                    status: 'pending',
                    paymentVerified: false,
                    adminApproved: false,
                    paymentReference: this.generatePaymentReference(newUser.name, newUser.phone)
                };
                
                const referrals = JSON.parse(localStorage.getItem('nodinopro_referrals') || '[]');
                referrals.push(referralData);
                localStorage.setItem('nodinopro_referrals', JSON.stringify(referrals));
                
                console.log('üìä New referral tracked:', referralData);
                return referralData;
            },
            
            generatePaymentReference: function(name, phone) {
                const cleanName = name.replace(/\s+/g, '').substring(0, 6).toUpperCase();
                const cleanPhone = phone.replace(/\D/g, '').slice(-4);
                return `${cleanName}_${cleanPhone}`;
            },
            
            approveReferral: function(referralId) {
                const referrals = JSON.parse(localStorage.getItem('nodinopro_referrals') || '[]');
                const referral = referrals.find(r => r.timestamp === referralId);
                
                if (referral) {
                    referral.status = 'approved';
                    referral.adminApproved = true;
                    referral.approvedAt = Date.now();
                    localStorage.setItem('nodinopro_referrals', JSON.stringify(referrals));
                    
                    this.processCommission(referral);
                    console.log('‚úÖ Referral approved:', referralId);
                    return true;
                }
                console.log('‚ùå Referral not found:', referralId);
                return false;
            },
            
            processCommission: function(referral) {
                console.log(`üí∞ Processing commission: R${this.commissionRate} to ${referral.referrerCode}`);
                
                const earnings = JSON.parse(localStorage.getItem('nodinopro_earnings') || '{}');
                if (!earnings[referral.referrerCode]) {
                    earnings[referral.referrerCode] = 0;
                }
                earnings[referral.referrerCode] += this.commissionRate;
                localStorage.setItem('nodinopro_earnings', JSON.stringify(earnings));
                
                console.log('üí∞ Commission processed successfully');
            },
            
            getEarnings: function(affiliateCode) {
                const earnings = JSON.parse(localStorage.getItem('nodinopro_earnings') || '{}');
                return earnings[affiliateCode] || 0;
            },
            
            getReferrals: function(affiliateCode) {
                const referrals = JSON.parse(localStorage.getItem('nodinopro_referrals') || '[]');
                return referrals.filter(r => r.referrerCode === affiliateCode);
            }
        };

        // ==================== OTP SYSTEM ====================
        const OTP_SYSTEM = {
            otpLength: 6,
            otpValidity: 15 * 60 * 1000,
            
            generateOTP: function() {
                const chars = '0123456789';
                let otp = '';
                for (let i = 0; i < this.otpLength; i++) {
                    otp += chars[Math.floor(Math.random() * chars.length)];
                }
                console.log('üîê Generated OTP:', otp);
                return otp;
            },
            
            storeOTP: function(userPhone, otp) {
                const otpData = {
                    otp: otp,
                    expires: Date.now() + this.otpValidity,
                    attempts: 0,
                    maxAttempts: 3,
                    userPhone: userPhone,
                    status: 'active'
                };
                
                localStorage.setItem(`nodinopro_otp_${userPhone}`, JSON.stringify(otpData));
                console.log('üíæ OTP stored for:', userPhone);
                return otpData;
            },
            
            verifyOTP: function(userPhone, enteredOTP) {
                if (!FORM_VALIDATION.validateOTP(enteredOTP)) {
                    return { valid: false, reason: 'Invalid OTP format' };
                }
                
                const storedData = localStorage.getItem(`nodinopro_otp_${userPhone}`);
                if (!storedData) {
                    console.log('‚ùå OTP not found for:', userPhone);
                    return { valid: false, reason: 'OTP not found or expired' };
                }
                
                const otpData = JSON.parse(storedData);
                
                if (Date.now() > otpData.expires) {
                    this.clearOTP(userPhone);
                    console.log('‚ùå OTP expired for:', userPhone);
                    return { valid: false, reason: 'OTP expired' };
                }
                
                if (otpData.attempts >= otpData.maxAttempts) {
                    this.clearOTP(userPhone);
                    console.log('‚ùå Max attempts exceeded for:', userPhone);
                    return { valid: false, reason: 'Maximum attempts exceeded' };
                }
                
                otpData.attempts++;
                localStorage.setItem(`nodinopro_otp_${userPhone}`, JSON.stringify(otpData));
                
                if (enteredOTP === otpData.otp) {
                    this.clearOTP(userPhone);
                    console.log('‚úÖ OTP verified successfully for:', userPhone);
                    return { valid: true, reason: 'OTP verified successfully' };
                } else {
                    console.log('‚ùå Invalid OTP attempt:', userPhone);
                    return { 
                        valid: false, 
                        reason: `Invalid OTP. ${otpData.maxAttempts - otpData.attempts} attempts remaining` 
                    };
                }
            },
            
            clearOTP: function(userPhone) {
                localStorage.removeItem(`nodinopro_otp_${userPhone}`);
                console.log('üßπ OTP cleared for:', userPhone);
            }
        };

        // ==================== PAYMENT SYSTEM ====================
        const PAYMENT_SYSTEM = {
            bankDetails: {
                bankName: "First National Bank (FNB)",
                accountHolder: "NODINOPRO PLATFORM", // CHANGE TO YOUR NAME
                accountNumber: "62836048711", // CHANGE TO YOUR FNB ACCOUNT
                accountType: "Current Account",
                branchCode: "250655",
                amount: "50.00"
            },
            
            updatePaymentReference: function() {
                const userName = document.getElementById('userName');
                const userPhone = document.getElementById('userPhone');
                const dynamicRef = document.getElementById('dynamicReference');
                const paymentRef = document.getElementById('paymentReference');
                
                if (!userName || !userPhone || !dynamicRef || !paymentRef) {
                    console.error('‚ùå Payment reference elements not found');
                    return;
                }
                
                const nameVal = userName.value.trim();
                const phoneVal = userPhone.value.trim();
                
                if (nameVal && phoneVal) {
                    const reference = AFFILIATE_SYSTEM.generatePaymentReference(nameVal, phoneVal);
                    dynamicRef.textContent = reference;
                    paymentRef.value = reference;
                    console.log('üí∞ Updated payment reference:', reference);
                }
            },
            
            submitPaymentRequest: function() {
                if (!FORM_VALIDATION.validateForm()) {
                    return;
                }
                
                const userName = document.getElementById('userName').value.trim();
                const userPhone = document.getElementById('userPhone').value.trim();
                const paymentRef = document.getElementById('paymentReference').value;
                const referralCode = document.getElementById('referralCode').value.trim();
                
                if (referralCode) {
                    AFFILIATE_SYSTEM.trackReferral(referralCode, { name: userName, phone: userPhone });
                    document.getElementById('referralInfo').classList.remove('hidden');
                    document.getElementById('referrerName').textContent = referralCode;
                    console.log('üë• Referral tracked:', referralCode);
                }
                
                const generatedOTP = OTP_SYSTEM.generateOTP();
                OTP_SYSTEM.storeOTP(userPhone, generatedOTP);
                
                document.getElementById('otpSection').classList.remove('hidden');
                this.showBankDetails();
                
                const paymentInstructions = `
‚úÖ PAYMENT INSTRUCTIONS - NODINOPRO ACCESS

STEP 1: MAKE PAYMENT
‚Ä¢ Amount: R${this.bankDetails.amount}
‚Ä¢ Bank: ${this.bankDetails.bankName}
‚Ä¢ Account Holder: ${this.bankDetails.accountHolder}
‚Ä¢ Account Number: ${this.bankDetails.accountNumber}
‚Ä¢ Branch Code: ${this.bankDetails.branchCode}
‚Ä¢ Reference: ${paymentRef}

STEP 2: WHATSAPP VERIFICATION
‚Ä¢ Send this information to 062 801 0124:
  "OTP: ${generatedOTP}
   Name: ${userName}
   Reference: ${paymentRef}"

STEP 3: RETURN TO PLATFORM
‚Ä¢ Come back here and enter the OTP to activate your account

‚è∞ OTP Valid for 15 minutes
                `;
                
                alert(paymentInstructions);
                console.log('üí∞ Payment submitted for:', userName);
                
                this.startOTPTimer();
            },
            
            showBankDetails: function() {
                const bankDetailsDiv = document.getElementById('bankDetails');
                if (bankDetailsDiv) {
                    bankDetailsDiv.innerHTML = `
                        <h4>üí∞ Banking Details</h4>
                        <div class="bank-info">
                            <p><strong>Bank:</strong> ${this.bankDetails.bankName}</p>
                            <p><strong>Account Holder:</strong> ${this.bankDetails.accountHolder}</p>
                            <p><strong>Account Number:</strong> ${this.bankDetails.accountNumber}</p>
                            <p><strong>Branch Code:</strong> ${this.bankDetails.branchCode}</p>
                            <p><strong>Amount:</strong> R${this.bankDetails.amount}</p>
                            <p><strong>Reference:</strong> <span id="dynamicReferenceDisplay">${document.getElementById('dynamicReference').textContent}</span></p>
                        </div>
                        <p style="font-size: 14px; color: #666; margin-top: 10px;">
                            üí° <strong>Important:</strong> Use the exact reference above when making payment.
                        </p>
                    `;
                    bankDetailsDiv.classList.remove('hidden');
                }
            },
            
            startOTPTimer: function() {
                let timeLeft = 15 * 60;
                const timerElement = document.getElementById('otpTime');
                
                if (!timerElement) {
                    console.error('‚ùå OTP timer element not found');
                    return;
                }
                
                if (window.otpTimer) {
                    clearInterval(window.otpTimer);
                }
                
                window.otpTimer = setInterval(() => {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    
                    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (timeLeft <= 0) {
                        clearInterval(window.otpTimer);
                        timerElement.textContent = 'EXPIRED';
                        timerElement.style.color = 'red';
                        alert('‚è∞ OTP has expired. Please submit a new payment request.');
                        console.log('‚è∞ OTP expired');
                        document.getElementById('otpSection').classList.add('hidden');
                    }
                    
                    timeLeft--;
                }, 1000);
                
                console.log('‚è∞ OTP timer started');
            },
            
            verifyOTP: function() {
                const userPhone = document.getElementById('userPhone').value.trim();
                const otp = document.getElementById('otpCode').value.trim();
                const userName = document.getElementById('userName').value.trim();
                
                if (!userPhone || !otp) {
                    alert('‚ùå Please enter your phone number and OTP');
                    return;
                }
                
                const verification = OTP_SYSTEM.verifyOTP(userPhone, otp);
                
                if (verification.valid) {
                    localStorage.setItem('nodinopro_access', 'granted');
                    localStorage.setItem('nodinopro_user', userName);
                    localStorage.setItem('nodinopro_user_phone', userPhone);
                    
                    document.getElementById('securityLayer').style.display = 'none';
                    document.getElementById('mainPlatform').classList.remove('hidden');
                    
                    PLATFORM_INIT.initialize();
                    
                    alert(`üéâ ACCESS GRANTED! Welcome to NODINOPRO, ${userName}!\n\nYou now have full access to:\n‚Ä¢ All Road Signs Database\n‚Ä¢ K53 Practice Tests\n‚Ä¢ Affiliate Earnings System`);
                    console.log('‚úÖ Platform access granted for:', userName);
                } else {
                    alert(`‚ùå OTP VERIFICATION FAILED\n\nReason: ${verification.reason}`);
                    console.log('‚ùå OTP verification failed:', verification.reason);
                }
            }
        };

        // ==================== ASSESSMENT SYSTEM ====================
        const ASSESSMENT_SYSTEM = {
            currentTest: null,
            userAnswers: [],
            currentQuestionIndex: 0,
            
            questions: {
                roadSigns: [
                    {
                        question: "What does a red octagonal sign mean?",
                        options: ["Stop", "Yield", "No Entry", "Speed Limit"],
                        correct: 0,
                        explanation: "A red octagonal sign always means STOP. You must come to a complete stop."
                    },
                    {
                        question: "What should you do when you see a triangular sign with a red border?",
                        options: ["Stop immediately", "Proceed with caution", "Yield right of way", "Speed up"],
                        correct: 1,
                        explanation: "Triangular signs with red borders are warning signs - proceed with caution."
                    },
                    {
                        question: "What does a blue circular sign indicate?",
                        options: ["Mandatory instruction", "Warning", "Prohibition", "Information"],
                        correct: 0,
                        explanation: "Blue circular signs give mandatory instructions that must be followed."
                    }
                ],
                rules: [
                    {
                        question: "What is the legal blood alcohol limit for drivers in South Africa?",
                        options: ["0.05g/100ml", "0.08g/100ml", "0.10g/100ml", "0.02g/100ml"],
                        correct: 0,
                        explanation: "The legal limit is 0.05g per 100ml of blood for normal drivers."
                    },
                    {
                        question: "What should you do when approaching a traffic circle?",
                        options: ["Yield to traffic from your right", "Speed up and enter quickly", "Yield to traffic already in the circle", "Stop completely before entering"],
                        correct: 2,
                        explanation: "Always yield to traffic already in the circle."
                    }
                ]
            },
            
            startTest: function(testType) {
                this.currentTest = testType;
                this.currentQuestionIndex = 0;
                this.userAnswers = new Array(this.questions[testType].length).fill(null);
                
                document.querySelector('.assessment-types').classList.add('hidden');
                document.getElementById('testContainer').classList.remove('hidden');
                document.getElementById('resultsArea').classList.add('hidden');
                
                console.log('üß™ Starting test:', testType);
                this.showQuestion();
                this.updateProgress();
            },
            
            showQuestion: function() {
                const questions = this.questions[this.currentTest];
                const question = questions[this.currentQuestionIndex];
                
                if (!question) return;
                
                const questionArea = document.getElementById('questionArea');
                if (!questionArea) return;
                
                questionArea.innerHTML = `
                    <h3>Question ${this.currentQuestionIndex + 1} of ${questions.length}</h3>
                    <p style="font-size: 1.2em; margin: 20px 0;">${question.question}</p>
                    <div class="quiz-options">
                        ${question.options.map((option, index) => `
                            <div class="quiz-option ${this.userAnswers[this.currentQuestionIndex] === index ? 'selected' : ''}" 
                                 onclick="ASSESSMENT_SYSTEM.selectAnswer(${index})">
                                ${String.fromCharCode(65 + index)}. ${option}
                            </div>
                        `).join('')}
                    </div>
                `;
                
                this.updateNavigation();
                this.updateProgress();
            },
            
            selectAnswer: function(answerIndex) {
                this.userAnswers[this.currentQuestionIndex] = answerIndex;
                this.showQuestion();
            },
            
            previousQuestion: function() {
                if (this.currentQuestionIndex > 0) {
                    this.currentQuestionIndex--;
                    this.showQuestion();
                }
            },
            
            nextQuestion: function() {
                const questions = this.questions[this.currentTest];
                if (this.currentQuestionIndex < questions.length - 1) {
                    this.currentQuestionIndex++;
                    this.showQuestion();
                }
            },
            
            submitTest: function() {
                const questions = this.questions[this.currentTest];
                let correctAnswers = 0;
                
                questions.forEach((question, index) => {
                    if (this.userAnswers[index] === question.correct) {
                        correctAnswers++;
                    }
                });
                
                const score = Math.round((correctAnswers / questions.length) * 100);
                this.showResults(score, correctAnswers, questions.length);
            },
            
            showResults: function(score, correct, total) {
                const resultsArea = document.getElementById('resultsArea');
                const testContainer = document.getElementById('testContainer');
                
                if (!resultsArea || !testContainer) return;
                
                testContainer.classList.add('hidden');
                resultsArea.classList.remove('hidden');
                
                let message = "";
                let color = "#dc3545";
                
                if (score >= 75) {
                    message = "üéâ Excellent! You're ready for the real test!";
                    color = "#28a745";
                } else if (score >= 50) {
                    message = "üìö Good effort! Keep practicing to improve.";
                    color = "#ffc107";
                } else {
                    message = "üí™ Keep studying! Review the material and try again.";
                }
                
                resultsArea.innerHTML = `
                    <div class="score-circle" style="background: ${color}">${score}%</div>
                    <h3>${message}</h3>
                    <p>You got ${correct} out of ${total} questions correct.</p>
                    <div style="margin: 20px 0;">
                        <button class="btn btn-primary" onclick="ASSESSMENT_SYSTEM.restartTest()">Try Again</button>
                        <button class="btn btn-success" onclick="navigateToPage('home')">Back to Home</button>
                    </div>
                `;
            },
            
            restartTest: function() {
                document.getElementById('resultsArea').classList.add('hidden');
                document.getElementById('testContainer').classList.add('hidden');
                document.querySelector('.assessment-types').classList.remove('hidden');
            },
            
            updateProgress: function() {
                const questions = this.questions[this.currentTest];
                const progress = ((this.currentQuestionIndex + 1) / questions.length) * 100;
                const progressBar = document.getElementById('testProgress');
                
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                }
            },
            
            updateNavigation: function() {
                const questions = this.questions[this.currentTest];
                const prevBtn = document.getElementById('prevQuestion');
                const nextBtn = document.getElementById('nextQuestion');
                const submitBtn = document.getElementById('submitTest');
                
                if (prevBtn) prevBtn.disabled = this.currentQuestionIndex === 0;
                if (nextBtn) nextBtn.disabled = this.currentQuestionIndex === questions.length - 1;
                if (submitBtn) submitBtn.style.display = this.currentQuestionIndex === questions.length - 1 ? 'block' : 'none';
            }
        };

        // ==================== ROAD SIGNS MANAGEMENT ====================
        const ROAD_SIGNS_MANAGER = {
            loadAllRoadSigns: function() {
                const container = document.getElementById('signsContainer');
                if (!container) return;
                
                container.innerHTML = '';
                
                ROAD_SIGNS_DATABASE.forEach(sign => {
                    const signElement = this.createSignElement(sign);
                    container.appendChild(signElement);
                });
            },
            
            createSignElement: function(sign) {
                const div = document.createElement('div');
                div.className = `road-sign ${this.getSignShape(sign.sign_code)}`;
                div.innerHTML = `
                    <div class="sign-content">${sign.sign_code}</div>
                    <div class="sign-tooltip">${sign.description}</div>
                `;
                div.addEventListener('click', () => this.showSignDetail(sign));
                return div;
            },
            
            getSignShape: function(signCode) {
                if (signCode.startsWith('R1')) return 'octagon';
                if (signCode.startsWith('R2')) return 'circle'; 
                if (signCode.startsWith('W')) return 'triangle';
                if (signCode.startsWith('IN')) return 'rectangle';
                return 'rectangle';
            },
            
            showSignDetail: function(sign) {
                const modal = document.getElementById('signModal');
                const content = document.getElementById('modalContent');
                
                if (!modal || !content) return;
                
                content.innerHTML = `
                    <h3>${sign.description}</h3>
                    <div class="road-sign ${this.getSignShape(sign.sign_code)}" style="margin: 20px auto; width: 150px; height: 150px; font-size: 1.5em;">
                        ${sign.sign_code}
                    </div>
                    <p><strong>Category:</strong> ${sign.category}</p>
                    <p><strong>Sign Code:</strong> ${sign.sign_code}</p>
                    <p><strong>Action Required:</strong> ${this.getActionForSign(sign)}</p>
                `;
                
                modal.classList.remove('hidden');
            },
            
            getActionForSign: function(sign) {
                switch(sign.category) {
                    case 'Control': return "You MUST obey this sign. Failure to comply is a traffic offense.";
                    case 'Warning': return "Be prepared for the hazard ahead. Adjust your speed and position.";
                    case 'Information': return "This sign provides useful information for navigation.";
                    default: return "Follow the instructions indicated by the sign.";
                }
            },
            
            filterSigns: function(category) {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                const container = document.getElementById('signsContainer');
                if (!container) return;
                
                container.innerHTML = '';
                
                const filteredSigns = category === 'all' 
                    ? ROAD_SIGNS_DATABASE 
                    : ROAD_SIGNS_DATABASE.filter(sign => sign.category === category);
                
                filteredSigns.forEach(sign => {
                    const signElement = this.createSignElement(sign);
                    container.appendChild(signElement);
                });
            }
        };

        // ==================== PLATFORM INITIALIZATION ====================
        const PLATFORM_INIT = {
            initialize: function() {
                console.log('üöÄ Initializing NODINOPRO Platform...');
                
                const userPhone = localStorage.getItem('nodinopro_user_phone');
                const userName = localStorage.getItem('nodinopro_user');
                
                if (!userPhone || !userName) return;
                
                document.getElementById('currentUser').textContent = userName;
                
                const affiliateCode = AFFILIATE_SYSTEM.generateAffiliateCode(userPhone);
                document.getElementById('userAffiliateCode').textContent = affiliateCode;
                
                this.updateEarningsDisplay(affiliateCode);
                ROAD_SIGNS_MANAGER.loadAllRoadSigns();
                this.setupEventListeners();
                this.navigateToPage('home');
                
                // Fix scrolling
                document.body.style.overflow = 'auto';
                document.body.style.height = '100vh';
            },
            
            updateEarningsDisplay: function(affiliateCode) {
                const earnings = AFFILIATE_SYSTEM.getEarnings(affiliateCode);
                document.getElementById('earningsDisplay').textContent = `Earnings: R${earnings}`;
            },
            
            setupEventListeners: function() {
                const prevBtn = document.getElementById('prevQuestion');
                const nextBtn = document.getElementById('nextQuestion');
                const submitBtn = document.getElementById('submitTest');
                
                if (prevBtn) prevBtn.addEventListener('click', () => ASSESSMENT_SYSTEM.previousQuestion());
                if (nextBtn) nextBtn.addEventListener('click', () => ASSESSMENT_SYSTEM.nextQuestion());
                if (submitBtn) submitBtn.addEventListener('click', () => ASSESSMENT_SYSTEM.submitTest());
                
                const closeModal = document.getElementById('closeModal');
                if (closeModal) closeModal.addEventListener('click', this.closeSignModal);
                
                const modal = document.getElementById('signModal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeSignModal();
                        }
                    });
                }
            },
            
            navigateToPage: function(page) {
                document.querySelectorAll('.side-nav-link').forEach(link => {
                    if (link.getAttribute('data-page') === page) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
                
                document.querySelectorAll('.page').forEach(p => {
                    if (p.id === page) {
                        p.classList.add('active');
                    } else {
                        p.classList.remove('active');
                    }
                });
                
                if (page === 'road-signs') {
                    ROAD_SIGNS_MANAGER.loadAllRoadSigns();
                } else if (page === 'affiliate-dashboard') {
                    this.showAffiliateDashboard();
                } else if (page === 'assessments') {
                    document.querySelector('.assessment-types').classList.remove('hidden');
                    document.getElementById('testContainer').classList.add('hidden');
                    document.getElementById('resultsArea').classList.add('hidden');
                }
            },
            
            showAffiliateDashboard: function() {
                const affiliateCode = document.getElementById('userAffiliateCode').textContent;
                const referrals = AFFILIATE_SYSTEM.getReferrals(affiliateCode);
                const earnings = AFFILIATE_SYSTEM.getEarnings(affiliateCode);
                
                document.getElementById('totalReferrals').textContent = referrals.length;
                document.getElementById('approvedReferrals').textContent = referrals.filter(r => r.status === 'approved').length;
                document.getElementById('pendingReferrals').textContent = referrals.filter(r => r.status === 'pending').length;
                document.getElementById('totalEarnings').textContent = `R${earnings}`;
                
                this.displayReferralList(referrals);
            },
            
            displayReferralList: function(referrals) {
                const container = document.getElementById('referralList');
                if (!container) return;
                
                if (referrals.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 3em; margin-bottom: 15px;">üë•</div>
                            <h4>No referrals yet</h4>
                            <p>Share your affiliate code with friends to start earning!</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = referrals.map(ref => `
                    <div class="referral-item ${ref.status}" style="padding: 15px; margin: 10px 0; border-radius: 8px; background: #f8f9fa; border-left: 4px solid ${ref.status === 'approved' ? '#28a745' : '#ffc107'};">
                        <div style="display: flex; justify-content: between; align-items: center;">
                            <div>
                                <strong>${ref.newUser.name}</strong> 
                                <span style="color: #666; font-size: 14px;">- ${ref.newUser.phone}</span>
                            </div>
                            <span class="status-badge" style="padding: 4px 12px; border-radius: 15px; font-size: 12px; background: ${ref.status === 'approved' ? '#28a745' : '#ffc107'}; color: white;">
                                ${ref.status.toUpperCase()}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: between; align-items: center; margin-top: 8px;">
                            <span style="font-size: 12px; color: #666;">
                                Reference: ${ref.paymentReference}
                            </span>
                            <span class="amount" style="font-weight: bold; color: ${ref.status === 'approved' ? '#28a745' : '#6c757d'};">
                                R${ref.status === 'approved' ? '50' : '0'}
                            </span>
                        </div>
                    </div>
                `).join('');
            },
            
            closeSignModal: function() {
                const modal = document.getElementById('signModal');
                if (modal) {
                    modal.classList.add('hidden');
                }
            },
            
            copyAffiliateCode: function() {
                const code = document.getElementById('userAffiliateCode').textContent;
                
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(code).then(() => {
                        alert(`‚úÖ Affiliate code copied to clipboard!\n\nShare this code: ${code}`);
                    }).catch(err => {
                        this.fallbackCopy(code);
                    });
                } else {
                    this.fallbackCopy(code);
                }
            },
            
            fallbackCopy: function(code) {
                const textArea = document.createElement('textarea');
                textArea.value = code;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    alert(`‚úÖ Affiliate code copied to clipboard!\n\nShare this code: ${code}`);
                } catch (err) {
                    alert('‚ùå Failed to copy affiliate code. Please copy manually: ' + code);
                }
                
                document.body.removeChild(textArea);
            }
        };

        // ==================== GLOBAL FUNCTIONS ====================
        window.checkAccess = function() {
            const hasAccess = localStorage.getItem('nodinopro_access');
            if (hasAccess === 'granted') {
                document.getElementById('securityLayer').style.display = 'none';
                document.getElementById('mainPlatform').classList.remove('hidden');
                PLATFORM_INIT.initialize();
            } else {
                PAYMENT_SYSTEM.updatePaymentReference();
            }
        };

        window.validateForm = FORM_VALIDATION.validateForm.bind(FORM_VALIDATION);
        window.submitPaymentRequest = PAYMENT_SYSTEM.submitPaymentRequest.bind(PAYMENT_SYSTEM);
        window.verifyOTP = PAYMENT_SYSTEM.verifyOTP.bind(PAYMENT_SYSTEM);
        window.updatePaymentReference = PAYMENT_SYSTEM.updatePaymentReference.bind(PAYMENT_SYSTEM);
        window.navigateToPage = PLATFORM_INIT.navigateToPage.bind(PLATFORM_INIT);
        window.copyAffiliateCode = PLATFORM_INIT.copyAffiliateCode.bind(PLATFORM_INIT);
        window.showAffiliateDashboard = PLATFORM_INIT.showAffiliateDashboard.bind(PLATFORM_INIT);
        window.filterSigns = ROAD_SIGNS_MANAGER.filterSigns.bind(ROAD_SIGNS_MANAGER);
        window.startTest = ASSESSMENT_SYSTEM.startTest.bind(ASSESSMENT_SYSTEM);

        window.logout = function() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('nodinopro_access');
                localStorage.removeItem('nodinopro_user');
                localStorage.removeItem('nodinopro_user_phone');
                location.reload();
            }
        };

        // Initialize platform
        window.addEventListener('load', function() {
            console.log('üöÄ NODINOPRO Platform Loading...');
            checkAccess();
        });
    </script>
</body>
</html>
